-- Expanded and improved trivia game data
local triviaQuestions = {
    { question = "The Minecraft world is infinite.\nTrue or False?", answer = "False" },
    { question = "Creepers were originally a coding bug.\nTrue or False?", answer = "True" },
    { question = "Diamonds can be mined with a wooden pickaxe.\nTrue or False?", answer = "False" },
    { question = "Gold tools mine faster than diamond tools.\nTrue or False?", answer = "True" },
    { question = "Endermen can teleport through walls.\nTrue or False?", answer = "True" },
    { question = "A sword can block damage in the current\nversion of Minecraft. True or False?", answer = "False" },
    { question = "You can sleep in the Nether to set your\nspawn point. True or False?", answer = "False" },
    { question = "Obsidian can only be mined with a diamond\npickaxe. True or False?", answer = "True" }
}

local usedQuestions = {} -- Track questions that have already been used
local playerScore = 0 -- Track the player's score
local currentQuestionIndex = nil -- Current question index
local triviaFeedback = "" -- Feedback message for the user

-- Function to select a random question that has not been used
local function selectRandomQuestion()
    -- If all questions are used, reset the list
    if #usedQuestions == #triviaQuestions then
        usedQuestions = {}
    end

    -- Randomly select a question index that has not been used
    repeat
        currentQuestionIndex = math.random(1, #triviaQuestions)
    until not usedQuestions[currentQuestionIndex]

    usedQuestions[currentQuestionIndex] = true -- Mark this question as used
end

-- Initial question selection
selectRandomQuestion()

-- Improved feedback and scoring mechanism
function getDynamicLine(name, page)
    if name == "triviaQuestion" then
        return triviaQuestions[currentQuestionIndex].question
    elseif name == "triviaFeedback" then
        return triviaFeedback
    elseif name == "playerScore" then
        return "^f3Your Score: " .. playerScore
    end
    return ""  -- Ensure no unintended output
end

-- Function to handle dynamic commands
function runDynamicCommand(name, client, page)
    local input = ""

    -- Handle specific commands
    if name == "answerTrue" then
        input = "true"
    elseif name == "answerFalse" then
        input = "false"
    else
        print("Unexpected command: " .. name)
        return
    end

    print("Received input: '" .. input .. "' from client " .. tostring(client))

    if input == "true" or input == "false" then
        local correctAnswer = triviaQuestions[currentQuestionIndex].answer:lower()
        if input == correctAnswer then
            playerScore = playerScore + 1
            triviaFeedback = "^f5RIGHT! Your answer is correct.\nYour score is: " .. playerScore
        else
            triviaFeedback = "^fEWRONG! The correct answer was '" .. correctAnswer .. "'.\nYour score is: " .. playerScore
        end
        -- Select a new random question
        selectRandomQuestion()
    else
        triviaFeedback = "^fEInvalid input! Please click 'True' or 'False'."
    end

    -- Refresh the page to show the updated feedback
    refresh(client)
end
